<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - GESTOR DE MANTENIMIENTO PREVENTIVO</title>
    <link rel="stylesheet" href="../css/login.css">
    <link rel="stylesheet" href="../css/dark-theme.css">
    <link rel="stylesheet" href="../css/improved-dark-theme.css">
    <link rel="stylesheet" href="../css/responsive.css">
</head>
<body>
    <!-- Quick Settings -->
    <div class="quick-settings">
        <button class="quick-setting-btn" id="quickLanguageToggle" aria-label="Cambiar idioma">
            <span class="setting-icon">🌐</span>
            <span class="setting-text" id="quickLanguageText">ES</span>
        </button>
        <button class="quick-setting-btn" id="quickThemeToggle" aria-label="Cambiar tema">
            <span class="setting-icon">🌓</span>
            <span class="setting-text" id="quickThemeText">☀️</span>
        </button>
    </div>

    <div class="login-container">
        <!-- Login Form Section -->
        <div class="login-form-section">
            <!-- Logo -->
            <div class="login-logo">
                <div class="logo-icon">
                    <span class="logo-text">GMPI</span>
                </div>
                <h1 class="system-title" data-translate="system_title">Gestor de Mantenimiento Preventivo</h1>
                <p class="system-subtitle" data-translate="system_subtitle">Infraestructuras Escolares</p>
            </div>

            <!-- Login Form -->
            <form class="login-form" id="loginForm" novalidate aria-label="Formulario de inicio de sesión">
                    <div class="form-header">
                        <h2 id="login-title" data-translate="login_title">Iniciar Sesión</h2>
                        <p data-translate="login_subtitle">Accede a tu panel de inspector</p>
                    </div>

                    <!-- Error/Success Messages -->
                    <div class="message-container" id="messageContainer" role="alert" aria-live="polite" aria-atomic="true">
                        <!-- Messages will be inserted here -->
                    </div>

                    <!-- Email Input -->
                    <div class="input-group">
                        <label for="email" class="input-label" id="email-label">
                            <span data-translate="email_label">Correo Electrónico</span>
                            <span class="required-indicator" aria-hidden="true">*</span>
                        </label>
                        <div class="input-wrapper">
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                class="form-input" 
                                placeholder="Ejemplo: admin@colegio.edu"
                                required
                                autocomplete="username"
                                aria-labelledby="email-label"
                                aria-describedby="email-error email-help"
                                aria-invalid="false"
                                autofocus
                            >
                            <span class="input-icon" aria-hidden="true">📧</span>
                            <span class="input-status" id="email-status" aria-hidden="true"></span>
                        </div>
                        <div class="field-help" id="email-help" data-translate="email_help">Ingresa tu correo electrónico institucional</div>
                        <div class="field-error" id="email-error" role="alert"></div>
                    </div>

                    <!-- Password Input -->
                    <div class="input-group">
                        <label for="password" class="input-label" id="password-label">
                            <span data-translate="password_label">Contraseña</span>
                            <span class="required-indicator" aria-hidden="true">*</span>
                        </label>
                        <div class="input-wrapper">
                            <input 
                                type="password" 
                                id="password" 
                                name="password" 
                                class="form-input" 
                                placeholder="Ingresa tu contraseña"
                                required
                                autocomplete="current-password"
                                aria-labelledby="password-label"
                                aria-describedby="password-error password-help password-toggle"
                                aria-invalid="false"
                                minlength="6"
                            >
                            <span class="input-icon" aria-hidden="true">🔒</span>
                            <button 
                                type="button" 
                                class="toggle-password" 
                                id="togglePassword"
                                aria-label="Mostrar contraseña"
                                aria-describedby="password-toggle"
                                tabindex="0"
                            >
                                <span class="toggle-icon" aria-hidden="true">👁️</span>
                            </button>
                            <span class="input-status" id="password-status" aria-hidden="true"></span>
                        </div>
                        <div class="field-help" id="password-help" data-translate="password_help">Contraseña de tu cuenta de inspector</div>
                        <div class="field-error" id="password-error" role="alert"></div>
                    </div>

                    <!-- Security Features -->
                    <div class="security-info" id="securityInfo">
                        <div class="attempts-counter" id="attemptsCounter" style="display: none;">
                            <span class="attempts-icon" aria-hidden="true">⚠️</span>
                            <span class="attempts-text"></span>
                        </div>
                        <div class="captcha-container" id="captchaContainer" style="display: none;">
                            <label for="captcha-input">Verificación de seguridad:</label>
                            <div class="captcha-wrapper">
                                <span class="captcha-question" id="captchaQuestion"></span>
                                <input type="text" id="captcha-input" class="captcha-input" placeholder="Respuesta" aria-describedby="captcha-help">
                                <button type="button" class="captcha-refresh" id="captchaRefresh" aria-label="Generar nueva verificación">🔄</button>
                            </div>
                            <div class="field-help" id="captcha-help">Resuelve la operación matemática para continuar</div>
                        </div>
                    </div>

                    <!-- Form Options -->
                    <div class="form-options">
                        <label class="remember-checkbox">
                            <input type="checkbox" id="rememberUser" name="rememberUser" aria-describedby="remember-help">
                            <span class="checkmark" aria-hidden="true"></span>
                            <span class="checkbox-label" data-translate="remember_me">Recordar usuario</span>
                        </label>
                        <a href="#" class="forgot-password" aria-label="Enlace para recuperar contraseña" data-translate="forgot_password">¿Olvidaste tu contraseña?</a>
                    </div>
                    <div class="field-help" id="remember-help" data-translate="remember_help">Tu usuario se guardará de forma segura en este dispositivo</div>

                    <!-- Submit Button -->
                    <button type="submit" class="login-btn" id="loginButton" aria-describedby="login-help">
                        <span class="btn-icon" aria-hidden="true">🔐</span>
                        <span class="btn-text" data-translate="login_button">Iniciar Sesión</span>
                        <span class="btn-loader" id="btnLoader" aria-hidden="true">⟳</span>
                    </button>
                    <div class="field-help" id="login-help" data-translate="login_help">Tiempo promedio de inicio: menos de 5 segundos</div>

                    <!-- Register Button -->
                    <button type="button" class="login-btn" style="background-color: #e67e22; margin-top: 16px;" onclick="window.location.href='register-inspector.html'">
                        <span class="btn-icon" aria-hidden="true">👤</span>
                        <span class="btn-text" data-translate="create_account">Crear Nueva Cuenta</span>
                    </button>

            

                    <!-- Accessibility Info -->
                    <div class="accessibility-info sr-only">
                        <p data-translate="accessibility_info">Este formulario es compatible con lectores de pantalla y navegación por teclado.</p>
                        <p data-translate="accessibility_navigation">Use Tab para navegar, Enter para enviar, y Space para activar controles.</p>
                    </div>
                </form>
        </div>

        <!-- Visual Section -->
        <div class="login-visual-section">
            <div class="visual-content">
                <div class="visual-icon">
                    <span class="visual-emoji">🏫</span>
                </div>
                <h3 class="visual-title" data-translate="visual_title">Sistema de Gestión</h3>
                <p class="visual-subtitle" data-translate="visual_subtitle">Mantenimiento Preventivo para Infraestructuras Educativas</p>
                <div class="visual-features">
                    <div class="feature-item">
                        <div class="feature-icon">📊</div>
                        <div class="feature-text">
                            <h4 data-translate="feature_support">Soporte</h4>
                            <p data-translate="feature_support_desc">Accede a el soporte técnico</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🔧</div>
                        <div class="feature-text">
                            <h4 data-translate="feature_maintenance">Mantenimiento Programado</h4>
                            <p data-translate="feature_maintenance_desc">Automatiza las tareas de mantenimiento</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🏫</div>
                        <div class="feature-text">
                            <h4 data-translate="feature_infrastructure">Infraestructuras</h4>
                            <p data-translate="feature_infrastructure_desc">Gestiona múltiples sedes desde un solo lugar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Toggle password visibility
        document.addEventListener('DOMContentLoaded', function() {
            const togglePassword = document.getElementById('togglePassword');
            if (togglePassword) {
                togglePassword.addEventListener('click', function() {
                    const passwordInput = document.getElementById('password');
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    this.querySelector('.toggle-icon').textContent = type === 'password' ? '👁️' : '👁️‍🗨️';
                });
            }
        });
    </script>

    <!-- Scripts mejorados para validación con Supabase -->
    <!-- Script de limpieza de sesión - DEBE IR PRIMERO -->
    <script src="../javascript/route-manager.js"></script>
    <script src="../javascript/session-cleaner.js"></script>
    <script src="https://cdn.skypack.dev/@supabase/supabase-js" defer></script>
    <script src="../javascript/supabase-config.js"></script>
    <script src="../javascript/supabase-login.js"></script>
    <script src="../javascript/settings.js"></script>
    <script>
        // Inicializar sistema de configuración
        document.addEventListener('DOMContentLoaded', function() {
            if (window.SettingsManager) {
                window.settingsManager = new SettingsManager();
            }
            
            // Conectar botones de configuración rápida
            const languageBtn = document.getElementById('quickLanguageToggle');
            const themeBtn = document.getElementById('quickThemeToggle');
            
            if (languageBtn) {
                languageBtn.addEventListener('click', function() {
                    if (window.settingsManager) {
                        window.settingsManager.toggleLanguage();
                    }
                });
            }
            
            if (themeBtn) {
                themeBtn.addEventListener('click', function() {
                    if (window.settingsManager) {
                        window.settingsManager.toggleTheme();
                    }
                });
            }
        });
    </script>
</body>
</html>
